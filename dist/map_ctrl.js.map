{"version":3,"sources":["../src/map_ctrl.js"],"names":["L","moment","appEvents","MetricsPanelCtrl","panelDefaults","maxDataPoints","autoZoom","MapCtrl","$scope","$injector","_","defaults","panel","timeSrv","get","coords","leafMap","locationLayer","events","on","onInitEditMode","bind","onPanelTeardown","onPanelSizeChanged","onDataReceived","$timeout","cancel","nextTickPromise","evt","clearLayers","invalidateSize","onPanelClear","map","id","scrollWheelZoom","zoomSnap","zoomDelta","featureGroup","addTo","control","layers","tileLayer","attribution","maxZoom","forcedOverlay","subdomains","mapBaseLayerChange","mapZoomToBox","e","removeFrom","overlay","layer","options","setZIndex","zIndex","bounds","reduce","t","c","boxZoomBounds","contains","position","from","Math","min","timestamp","to","max","Infinity","isFinite","setTime","utc","i","length","pollution","svg_cloud","meIcon","divIcon","className","html","replace","iconAnchor","iconSize","popupAnchor","meMarker","marker","icon","title","location","addLayer","zoomToFit","fitBounds","getBounds","pad","data","setupMap","setView","datapoints","aqi","lat","lon","city","push","latLng","addDataToMap","templateUrl"],"mappings":"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","sourcesContent":["import L from './leaflet/leaflet.js';\r\nimport moment from 'moment';\r\n\r\nimport appEvents from 'app/core/app_events';\r\nimport { MetricsPanelCtrl } from 'app/plugins/sdk';\r\n\r\nimport './leaflet/leaflet.css!';\r\nimport './partials/module.css!';\r\n\r\nconst panelDefaults = {\r\n  maxDataPoints: 500,\r\n  autoZoom: true\r\n}\r\n\r\nexport class MapCtrl extends MetricsPanelCtrl {\r\n  constructor($scope, $injector) {\r\n    super($scope, $injector);\r\n    _.defaults(this.panel, panelDefaults);\r\n\r\n    this.timeSrv = $injector.get('timeSrv');\r\n    this.coords = [];\r\n    this.leafMap = null;\r\n    this.locationLayer = null;\r\n\r\n    // Panel events\r\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n    this.events.on('panel-teardown', this.onPanelTeardown.bind(this));\r\n    this.events.on('panel-size-changed', this.onPanelSizeChanged.bind(this));\r\n    this.events.on('data-received', this.onDataReceived.bind(this));\r\n  }\r\n\r\n  onInitEditMode() {\r\n    //Editor tab needs to be edited\r\n    // this.addEditorTab('Options', 'public/plugins/test-panel/partials/options.html', 2);\r\n  }\r\n\r\n  onPanelTeardown() {\r\n    this.$timeout.cancel(this.nextTickPromise);\r\n  }\r\n\r\n\r\n  onPanelClear(evt) {\r\n    this.locationLayer.clearLayers();\r\n  }\r\n\r\n  onPanelSizeChanged() {\r\n    if (this.leafMap) {\r\n      this.leafMap.invalidateSize();\r\n    }\r\n  }\r\n\r\n  setupMap() {\r\n    // Create the map or get it back in a clean state if it already exists\r\n    if (this.leafMap) {\r\n      this.onPanelClear();\r\n      return;\r\n    }\r\n    // Create the map\r\n    this.leafMap = L.map('trackmap-' + this.panel.id, {\r\n      scrollWheelZoom: true,\r\n      zoomSnap: 0.5,\r\n      zoomDelta: 1\r\n    });\r\n    this.locationLayer = L.featureGroup().addTo(this.leafMap);\r\n    // Define layers and add them to the control widget\r\n    L.control.layers({\r\n      'OpenStreetMap': L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\r\n        attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a>',\r\n        maxZoom: 19\r\n      }).addTo(this.leafMap), // Add default layer to map\r\n      'OpenTopoMap': L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {\r\n        attribution: 'Map data: &copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a>, <a href=\"http://viewfinderpanoramas.org\">SRTM</a> | Map style: &copy; <a href=\"https://opentopomap.org\">OpenTopoMap</a> (<a href=\"https://creativecommons.org/licenses/by-sa/3.0/\">CC-BY-SA</a>)',\r\n        maxZoom: 17\r\n      }),\r\n      'Satellite': L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {\r\n        attribution: 'Imagery &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community',\r\n        // This map doesn't have labels so we force a label-only layer on top of it\r\n        forcedOverlay: L.tileLayer('https://stamen-tiles-{s}.a.ssl.fastly.net/toner-labels/{z}/{x}/{y}.png', {\r\n          attribution: 'Labels by <a href=\"http://stamen.com\">Stamen Design</a>, <a href=\"http://creativecommons.org/licenses/by/3.0\">CC BY 3.0</a> &mdash; Map data &copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a>',\r\n          subdomains: 'abcd',\r\n          maxZoom: 20\r\n        })\r\n      })\r\n    }).addTo(this.leafMap);\r\n    // Events\r\n    this.leafMap.on('baselayerchange', this.mapBaseLayerChange.bind(this));\r\n    this.leafMap.on('boxzoomend', this.mapZoomToBox.bind(this));\r\n  }\r\n\r\n  mapBaseLayerChange(e) {\r\n    // If a tileLayer has a 'forcedOverlay' attribute, always enable/disable it\r\n    // along with the layer\r\n    if (this.leafMap.forcedOverlay) {\r\n      this.leafMap.forcedOverlay.removeFrom(this.leafMap);\r\n      this.leafMap.forcedOverlay = null;\r\n    }\r\n    let overlay = e.layer.options.forcedOverlay;\r\n    if (overlay) {\r\n      overlay.addTo(this.leafMap);\r\n      overlay.setZIndex(e.layer.options.zIndex + 1);\r\n      this.leafMap.forcedOverlay = overlay;\r\n    }\r\n  }\r\n\r\n  mapZoomToBox(e) {\r\n    // Find time bounds of selected coordinates\r\n    const bounds = this.coords.reduce(\r\n      function (t, c) {\r\n        if (e.boxZoomBounds.contains(c.position)) {\r\n          t.from = Math.min(t.from, c.timestamp);\r\n          t.to = Math.max(t.to, c.timestamp);\r\n        }\r\n        return t;\r\n      },\r\n      { from: Infinity, to: -Infinity }\r\n    );\r\n\r\n    // Set the global time range\r\n    if (isFinite(bounds.from) && isFinite(bounds.to)) {\r\n      this.timeSrv.setTime({\r\n        from: moment.utc(bounds.from),\r\n        to: moment.utc(bounds.to)\r\n      });\r\n    }\r\n  }\r\n\r\n  // Add clouds to the map\r\n  addDataToMap() {\r\n    this.locationLayer.clearLayers();\r\n    for (var i = 0; i < this.coords.length; i++) {\r\n      if (this.coords[i].pollution <= 50)\r\n        var svg_cloud = '<svg class=\"clouds cloud-green\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" version=\"1.1\" x=\"0\" y=\"0\" width=\"512\" height=\"512\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\"><path id=\"cloud-icon\" d=\"M406.1 227.63c-8.23-103.65-144.71-137.8-200.49-49.05 -36.18-20.46-82.33 3.61-85.22 45.9C80.73 229.34 50 263.12 50 304.1c0 44.32 35.93 80.25 80.25 80.25h251.51c44.32 0 80.25-35.93 80.25-80.25C462 268.28 438.52 237.94 406.1 227.63z\"/></svg>';\r\n      else if (this.coords[i].pollution <= 100)\r\n        var svg_cloud = '<svg class=\"clouds cloud-yellow\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" version=\"1.1\" x=\"0\" y=\"0\" width=\"512\" height=\"512\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\"><path id=\"cloud-icon\" d=\"M406.1 227.63c-8.23-103.65-144.71-137.8-200.49-49.05 -36.18-20.46-82.33 3.61-85.22 45.9C80.73 229.34 50 263.12 50 304.1c0 44.32 35.93 80.25 80.25 80.25h251.51c44.32 0 80.25-35.93 80.25-80.25C462 268.28 438.52 237.94 406.1 227.63z\"/></svg>';\r\n      else if (this.coords[i].pollution <= 150)\r\n        var svg_cloud = '<svg class=\"clouds cloud-orange\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" version=\"1.1\" x=\"0\" y=\"0\" width=\"512\" height=\"512\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\"><path id=\"cloud-icon\" d=\"M406.1 227.63c-8.23-103.65-144.71-137.8-200.49-49.05 -36.18-20.46-82.33 3.61-85.22 45.9C80.73 229.34 50 263.12 50 304.1c0 44.32 35.93 80.25 80.25 80.25h251.51c44.32 0 80.25-35.93 80.25-80.25C462 268.28 438.52 237.94 406.1 227.63z\"/></svg>';\r\n      else if (this.coords[i].pollution <= 200)\r\n        var svg_cloud = '<svg class=\"clouds cloud-red\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" version=\"1.1\" x=\"0\" y=\"0\" width=\"512\" height=\"512\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\"><path id=\"cloud-icon\" d=\"M406.1 227.63c-8.23-103.65-144.71-137.8-200.49-49.05 -36.18-20.46-82.33 3.61-85.22 45.9C80.73 229.34 50 263.12 50 304.1c0 44.32 35.93 80.25 80.25 80.25h251.51c44.32 0 80.25-35.93 80.25-80.25C462 268.28 438.52 237.94 406.1 227.63z\"/></svg>';\r\n      else if (this.coords[i].pollution <= 250)\r\n        var svg_cloud = '<svg class=\"clouds cloud-purple\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" version=\"1.1\" x=\"0\" y=\"0\" width=\"512\" height=\"512\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\"><path id=\"cloud-icon\" d=\"M406.1 227.63c-8.23-103.65-144.71-137.8-200.49-49.05 -36.18-20.46-82.33 3.61-85.22 45.9C80.73 229.34 50 263.12 50 304.1c0 44.32 35.93 80.25 80.25 80.25h251.51c44.32 0 80.25-35.93 80.25-80.25C462 268.28 438.52 237.94 406.1 227.63z\"/></svg>';\r\n      var meIcon = L.divIcon({\r\n        className: \"leaflet-data-marker\",\r\n        html: svg_cloud.replace('#', '%23'),\r\n        iconAnchor: [22, 28],\r\n        iconSize: [36, 42],\r\n        popupAnchor: [0, -30],\r\n      });\r\n      var meMarker = L.marker(this.coords[i].position, {\r\n        icon: meIcon,\r\n        title: \"AQI is \" + this.coords[i].pollution + \" in \" + this.coords[i].location\r\n      });\r\n      this.locationLayer.addLayer(meMarker);\r\n    }\r\n    this.zoomToFit();\r\n  }\r\n\r\n\r\n  zoomToFit() {\r\n    if (this.panel.autoZoom) {\r\n      this.leafMap.fitBounds(this.locationLayer.getBounds().pad(0.5));\r\n    }\r\n  }\r\n\r\n  onDataReceived(data) {\r\n    this.setupMap();\r\n    if (data.length === 0) {\r\n      // No data , show a world map and abort\r\n      this.leafMap.setView([0, 0], 1);\r\n      return;\r\n    }\r\n    this.coords.length = 0;\r\n    for (var i = 0; i < data[0].datapoints.length; i++) {\r\n      let aqi = data[0].datapoints[i][0];\r\n      let lat = data[1].datapoints[i];\r\n      let lon = data[2].datapoints[i];\r\n      const city = data[3].datapoints[i][0];\r\n      this.coords.push({\r\n        position: L.latLng(lat[0], lon[0]),\r\n        location: city,\r\n        pollution: aqi,\r\n        timestamp: lat[1]\r\n      });\r\n    }\r\n    this.addDataToMap();\r\n  }\r\n}\r\n\r\nMapCtrl.templateUrl = 'partials/module.html';"],"file":"map_ctrl.js"}